<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <title>Form</title>
</head>
<body>
    <form name="addItem" method="post" action="/items">
        <label>
            Name:
            <input type="text" name="name" />
        </label>
        <label>
            Email:
            <input type="text" name="email" />
        </label>
        <label>
            Phone:
            <input type="text" name="phone" />
        </label>
        <button name="btnSubmit"  type="submit">Add</button>
    </form>
    
    <div id="items-table-wrapper">
    </div>

</body>

<script language="JavaScript">

    document.forms.addItem.onsubmit = onAddItemSubmit;

    function onAddItemSubmit(event){
        var formData = getFromDataURI(this);
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/items", true);
        xhr.onreadystatechange = onItemsRequest;
        xhr.send(formData);
        return false;
    }

    function onItemsRequest() {
        if (this.readyState != 4) return;

        if (this.status != 200) {
            console.error(this.status + ': ' + xhr.statusText);
        } else {
            var items = JSON.parse(this.responseText);
            console.debug(items);
            if (!!items) {
                var tableWrapper = document.getElementById('items-table-wrapper');
                tableWrapper.innerHTML = '';
                var table = document.createElement('table');
                var headerRow = document.createElement('tr');
                headerRow.appendChild(document.createElement('th')).innerText = 'id';
                headerRow.appendChild(document.createElement('th')).innerText = 'name';
                headerRow.appendChild(document.createElement('th')).innerText = 'phone';
                headerRow.appendChild(document.createElement('th')).innerText = 'email';
                table.appendChild(headerRow);
                items.forEach(function(item, i, arr){
                    var row = document.createElement('tr');
                    row.appendChild(document.createElement('td')).innerText = item.id;
                    row.appendChild(document.createElement('td')).innerText = item.name;
                    row.appendChild(document.createElement('td')).innerText = item.phone;
                    row.appendChild(document.createElement('td')).innerText = item.email;
                    table.appendChild(row);
                })
                tableWrapper.appendChild(table);
                console.debug(tableWrapper);
            }

        }

    }

    function getFromDataURI(form){
        var res;
        res = 'name=' + encodeURIComponent(form.name.value);
        res += '&email=' + encodeURIComponent(form.email.value);
        res += '&phone=' + encodeURIComponent(form.phone.value);
        return res;
    }

</script>

</html>


